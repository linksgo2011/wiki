<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Spring boot 部署的几种方式 | web 工程师知识系统</title>
  <meta name="author" content="少个分号">
  
  <meta name="description" content="打包 Spring Boot 应用推荐使用 Spring Boot 的 jar 包进行部署，自带容器对环境依赖。当然也可以打包成 war 格式，并部署到 Servlet3.0 或者早期的 Servlet2.0 的容器中。
使用 Maven 或者 Gradle 打包 jar 文件,一般在工程中使用 w">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Spring boot 部署的几种方式">
  <meta property="og:site_name" content="web 工程师知识系统">

  
    <meta property="og:image" content="undefined">
  

  
    <link rel="alternative" href="/atom.xml" title="web 工程师知识系统" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>
</html>
<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">web 工程师知识系统</a><span class="split"></span><span class="title">Spring boot 部署的几种方式</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2019-11-17</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  <div class="col-xs-12 col-sm-3 col-md-3 toc"> 
	<!-- toc -->
<script type="text/javascript">
		jQuery(document).ready(function() {
 		   generateWikiTOC('.note', '.toc',  2 , 2 );
		});
</script>
  </div><!-- col-md-3 -->
  
  

  
  <div class="col-xs-12 col-sm-9 col-md-9 note">
	

	  <!-- content -->
	  <h2 id="打包-Spring-Boot-应用"><a href="#打包-Spring-Boot-应用" class="headerlink" title="打包 Spring Boot 应用"></a>打包 Spring Boot 应用</h2><p>推荐使用 Spring Boot 的 jar 包进行部署，自带容器对环境依赖。当然也可以打包成 war 格式，并部署到 Servlet3.0 或者早期的 Servlet2.0 的容器中。</p>
<p>使用 Maven 或者 Gradle 打包 jar 文件,一般在工程中使用 wapper 构建。</p>
<p>可以通过 Initializr 构建一个基本的 SPring Boot 项目练习， <a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a> </p>
<h2 id="使用-Maven-构建"><a href="#使用-Maven-构建" class="headerlink" title="使用 Maven 构建"></a>使用 Maven 构建</h2><p>在 Maven 的 pom.xml 文件中配置如下插件。</p>
<pre><code>    &lt;build&gt;
        &lt;plugins&gt;
            ...
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
</code></pre><p>在工程目录下的命令行运行 <code>./mvnw clean package</code></p>
<blockquote>
<p>./mvnw clean package </p>
</blockquote>
<p>构建成功后可以看到下面的信息。</p>
<pre><code>[INFO] --- maven-jar-plugin:3.1.2:jar (default-jar) @ spring-boot-boilerplate ---
[INFO] Building jar: /Users/nlin/Downloads/spring-boot-boilerplate/target/spring-boot-boilerplate-0.0.1-SNAPSHOT.jar
[INFO] 
[INFO] --- spring-boot-maven-plugin:2.2.1.RELEASE:repackage (repackage) @ spring-boot-boilerplate ---
[INFO] Replacing main artifact with repackaged archive
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  4.237 s
[INFO] Finished at: 2019-11-17T22:28:04+08:00
[INFO] ------------------------------------------------------------------------

</code></pre><h3 id="使用-gradle-构建"><a href="#使用-gradle-构建" class="headerlink" title="使用 gradle 构建"></a>使用 gradle 构建</h3><p>在 build.gradle 文件中有如下配置， org.springframework.boot 是用来运行和构建 Spring Boot 应用程序的，io.spring.dependency-management 是用来管理 Spring 项目各个依赖的版本，让其保持一致。</p>
<pre><code>plugins {
    id &#39;org.springframework.boot&#39; version &#39;2.1.3.RELEASE&#39;
    id &quot;io.spring.dependency-management&quot; version &quot;1.0.3.RELEASE&quot;
}

</code></pre><p>运行命令</p>
<blockquote>
<p>./gradle clean package </p>
</blockquote>
<p>我的项目名称是 spring-boot-boilerplate，因此制品是 spring-boot-boilerplate-0.0.1-SNAPSHOT.jar</p>
<h2 id="使用-Linux-命令-nohup-部署"><a href="#使用-Linux-命令-nohup-部署" class="headerlink" title="使用 Linux 命令 nohup 部署"></a>使用 Linux 命令 nohup 部署</h2><p>可以通过 <code>java -jar</code> 来运行 jar 文件，但是关闭窗口后会挂断应用程序，因此可以使用 <code>nohup</code> 来持续运行，需要注意的是使用 <code>nohup</code> 需要修改日志文件的流向 log.txt。</p>
<p>但 <code>nohup</code> 只是不挂断程序，不是指在后台运行，因此部署 Spring Boot 应用程序，还需要 <code>&amp;</code>。<code>&amp;</code> 指后台运行。</p>
<blockquote>
<p>nohup java -jar spring-boot-boilerplate-0.0.1-SNAPSHOT.jar &gt; log.txt &amp;</p>
</blockquote>
<p>这条需要在部署的服务器上运行，我们可以编写一个简单的 shell 脚本来完成。工作中，更多的是使用 ansible 脚本用于多台服务器批量操作。</p>
<p>先设置 ssh key，确保自己能使用 ssh 无密码能访问到目标服务器。然后通过 scp 拷贝文件到服务器。</p>
<blockquote>
<p> scp spring-boot-boilerplate-0.0.1-SNAPSHOT.jar <a href="mailto:root@192.168.1.86" target="_blank" rel="noopener">root@192.168.1.86</a>:/home/workspace</p>
</blockquote>
<p>192.168.1.86 为一台内网服务器地址。</p>
<p>然后通过远程执行 shell 脚本命令启动</p>
<blockquote>
<p> ssh <a href="mailto:root@192.168.1.86" target="_blank" rel="noopener">root@192.168.1.86</a> ‘nohup java -jar /home/workspace/spring-boot-boilerplate-0.0.1-SNAPSHOT.jar &gt; log.txt &amp;’</p>
</blockquote>
<p>启动之前需要杀死之前运行的 java 程序，否则会端口被占用。根据端口杀死占用的进程</p>
<blockquote>
<p>ssh <a href="mailto:root@192.168.1.86" target="_blank" rel="noopener">root@192.168.1.86</a> ‘output=$( netstat -apn | grep 8080 | grep LISTEN) &amp;&amp; read num1 num2 num3 num4 num5  &lt;&lt;&lt;${output//[^0-9]/ } &amp;&amp; kill -9 $num5 || pwd’</p>
</blockquote>
<h2 id="通过注册服务运行"><a href="#通过注册服务运行" class="headerlink" title="通过注册服务运行"></a>通过注册服务运行</h2><p>上面的方法比较简单，但是有一个问题，部署之后如果服务器重启需要再次启动程序。可以将 <code>java -jar xxx.jar</code> 这条命令作为服务注册到系统中，也可以方便的提供启动、销毁的方法供系统启动的时候使用。 </p>
<p>可以使用 <code>systemd</code> 的一系列方法，同时 ansible 等自动化工具也提供了非常方便的 API。</p>
<p>创建一个 service 文件</p>
<blockquote>
<p>vim spring-boot-boilerplate.service </p>
</blockquote>
<p>然后添加配置。</p>
<pre><code>
[Unit]
Description=spring-boot-boilerplate java application
After=syslog.target

[Service]
ExecStart=/usr/bin/nohup /usr/bin/java -jar /home/workspace/spring-boot-boilerplate.jar --spring.profiles.active=dev
SuccessExitStatus=143

[Install]
WantedBy=multi-user.target
</code></pre><p>ExecStart 填写 java 应用启动命令，当 <code>systemctl start</code> 的时候会调用这个命令。注意依然需要使用 <code>nohup</code> 保持后台运行。</p>
<p>配置完成后拷贝 service 文件到系统目录</p>
<blockquote>
<p>mv spring-boot-boilerplate.service /usr/lib/systemd/system/spring-boot-boilerplate.service</p>
</blockquote>
<p>然后启动</p>
<blockquote>
<p>systemctl start spring-boot-boilerplate</p>
</blockquote>
<p>可以通过 <code>systemctl status</code> 查看状态，也能看到启动的日志，如果有错误这个时候能看到异常信息。</p>
<blockquote>
<p>systemctl status spring-boot-boilerplate</p>
</blockquote>
<p>另外，不要忘记允许开机启动。</p>
<blockquote>
<p>systemctl enable spring-boot-boilerplate</p>
</blockquote>
<h2 id="使用-docker-运行"><a href="#使用-docker-运行" class="headerlink" title="使用 docker 运行"></a>使用 docker 运行</h2><p>使用 docker 运行 Spring Boot 就非常简单了，编译完成 jar 文件之后，只需要编写一个 Dockerfile</p>
<blockquote>
<p>vim Dockerfile</p>
</blockquote>
<pre><code>FROM openjdk:8-jdk-slim
VOLUME /tmp
ADD target/spring-boot-boilerplate.jar app.jar
ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]
</code></pre><p>cd 目录到当前目录下</p>
<blockquote>
<p>docker build -t spring-boot-docker  .</p>
</blockquote>
<p>使用 docker 查看构建出来的镜像</p>
<blockquote>
<p>docker images</p>
</blockquote>
<p>运行镜像，并将容器内端口（9999）映射到 8080</p>
<blockquote>
<p>docker run -it -p 9999:8080 spring-boot-docker</p>
</blockquote>
<p>如果单体机器可以直接使用 <code>nohup</code> 运行即可</p>
<blockquote>
<p>nohup docker run -it -p 9999:8080 spring-boot-docker &amp;</p>
</blockquote>
<p>如果需要部署集群，可以使用 swarm 和 kubernetes 构建弹性云系统。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://spring.io/guides/gs/spring-boot-docker/" target="_blank" rel="noopener">https://spring.io/guides/gs/spring-boot-docker/</a></li>
<li><a href="https://m.jb51.net/article/146105.htm" target="_blank" rel="noopener">https://m.jb51.net/article/146105.htm</a></li>
</ul>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
			
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
			
			
		
			
		
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
	
	
		<li class="prev"><a href="/Spring/spring/spring-security/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/Spring/spring/jpa-batch-operation/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  
  &copy; 2020 少个分号
  
  <a href="/about" target="_blank">关于本站</a> |
  <a href="https://github.com/linksgo2011/wiki" target="_blank">github |</a>
  <a href="http://www.printf.cn" target="_blank">我的博客</a>
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


</body>
</html>
