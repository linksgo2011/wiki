<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Gradle 构建 Spring boot 项目 | web 工程师知识系统</title>
  <meta name="author" content="少个分号">
  
  <meta name="description" content="背景介绍Gradle JVM 的富有突破性构建工具，可以通过编程式的编写构建脚本，非 xml 的方式构建项目，适用于相对复杂 Java 项目构建。
特性：

对已有的 maven 和 ivy 仓库的全面支持
支持传递性依赖管理，而不需要远程仓库或者 pom.xml 或者 ivy 配置文件
ant 式">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Gradle 构建 Spring boot 项目">
  <meta property="og:site_name" content="web 工程师知识系统">

  
    <meta property="og:image" content="undefined">
  

  
    <link rel="alternative" href="/atom.xml" title="web 工程师知识系统" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>
</html>
<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">web 工程师知识系统</a><span class="split"></span><span class="title">Gradle 构建 Spring boot 项目</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2018-11-14</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  <div class="col-xs-12 col-sm-3 col-md-3 toc"> 
	<!-- toc -->
<script type="text/javascript">
		jQuery(document).ready(function() {
 		   generateWikiTOC('.note', '.toc',  2 , 2 );
		});
</script>
  </div><!-- col-md-3 -->
  
  

  
  <div class="col-xs-12 col-sm-9 col-md-9 note">
	

	  <!-- content -->
	  <h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>Gradle JVM 的富有突破性构建工具，可以通过编程式的编写构建脚本，非 xml 的方式构建项目，适用于相对复杂 Java 项目构建。</p>
<p>特性：</p>
<ul>
<li>对已有的 maven 和 ivy 仓库的全面支持</li>
<li>支持传递性依赖管理，而不需要远程仓库或者 pom.xml 或者 ivy 配置文件</li>
<li>ant 式的任务和构建是 gradle 的第一公民</li>
<li>基于 groovy，其 build 脚本使用 groovy dsl 编写</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Gradle 需要依赖 Java，在 Mac 下可以使用 Homebrew 安装</p>
<blockquote>
<p>brew install gradle </p>
</blockquote>
<p>查看安装情况</p>
<blockquote>
<p>gradle -v </p>
</blockquote>
<p>Linux 下载解压后，添加 bin 目录到 path 路径下即可。</p>
<h2 id="常见概念"><a href="#常见概念" class="headerlink" title="常见概念"></a>常见概念</h2><h3 id="project"><a href="#project" class="headerlink" title="project"></a>project</h3><p>一个 project 或者 多个 project 是 gradle 的一个构建单位。每个 project 或许是一个 jar 包或者一个 web 应用，它也可以是一个由许多其他项目中产生的 jar 构成的 zip 压缩包。</p>
<p>一般默认 Java 项目以一个 project 构建，有时候也会有多模块（实际上就是多project）构建。project 可以存在父子关系。</p>
<h3 id="task"><a href="#task" class="headerlink" title="task"></a>task</h3><p>一个具体的构建任务，例如打包、测试、发布到仓库等。大部分情况下我们都是用插件提供的 task，不需要自己编写 task。</p>
<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>我们看到的 java 项目中必定有一个插件</p>
<blockquote>
<p>apply plugin: ‘java’</p>
</blockquote>
<p>Gradle 不一定只是为 Java 使用的，因此大部分情况下我们通过 java 插件提供构建能力。基本上 java 构建的过程比较类似。</p>
<ul>
<li>编译</li>
<li>测试</li>
<li>打包</li>
<li>发布</li>
</ul>
<p>插件是 Gradle 比较重要而概念，很多有用的 task 都是它提供的。常见的插件有：</p>
<ul>
<li>java</li>
<li>idea</li>
<li>io.spring.dependency-management</li>
<li>spring-boot</li>
</ul>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>就是 java 项目需要用到的其他 jar 包。原始的 java 开发我们都是从网上手动下载，然后倒入项目，使用 gradle 可以自动帮我们导入。</p>
<h3 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h3><p>Gradle 是在一个被称之为仓库的地方找寻所需的外部依赖。仓库即是一个按 group，name 和 version 规则进行存储的一些文件。Gradle 可以支持不同的仓库存储格式，如 Maven 和 Ivy，并且还提供多种与仓库进行通信的方式，如通过本地文件系统或 HTTP。</p>
<p>默认情况下，Gradle 没有定义任何仓库，你需要在使用外部依赖之前至少定义一个仓库，例如 Maven 中央仓库。</p>
<h2 id="java-插件基本使用"><a href="#java-插件基本使用" class="headerlink" title="java 插件基本使用"></a>java 插件基本使用</h2><p>引入 java 插件我们可以 通过 gradle tasks 查看该插件提供的 tasks。我们创建一个 build.gralde 然后引入  java 插件，再看看有什么任务。</p>
<blockquote>
<p>vim build.gradle </p>
</blockquote>
<pre><code>// 这个 build.gradle 只有一行代码
apply plugin: &#39;java&#39;
</code></pre><blockquote>
<p>gradle tasks</p>
</blockquote>
<pre><code>Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
classes - Assembles main classes.
clean - Deletes the build directory.
jar - Assembles a jar archive containing the main classes.
testClasses - Assembles test classes.

Build Setup tasks
-----------------
init - Initializes a new Gradle build.
wrapper - Generates Gradle wrapper files.

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in root project &#39;gradle-practise&#39;.
components - Displays the components produced by root project &#39;gradle-practise&#39;. [incubating]
dependencies - Displays all dependencies declared in root project &#39;gradle-practise&#39;.
dependencyInsight - Displays the insight into a specific dependency in root project &#39;gradle-practise&#39;.
dependentComponents - Displays the dependent components of components in root project &#39;gradle-practise&#39;. [incubating]
help - Displays a help message.
model - Displays the configuration model of root project &#39;gradle-practise&#39;. [incubating]
projects - Displays the sub-projects of root project &#39;gradle-practise&#39;.
properties - Displays the properties of root project &#39;gradle-practise&#39;.
tasks - Displays the tasks runnable from root project &#39;gradle-practise&#39;.

Verification tasks
------------------
check - Runs all checks.
test - Runs the unit tests.

</code></pre><p>使用 java 插件，我们需要按照规范设置目录，然后 gradle 会帮我们自动构建,这个目录不需要我们自己创建，按照 IDE 生成即可。</p>
<pre><code>project  
    +build  
    +src/main/java  
    +src/main/resources  
    +src/test/java  
    +src/test/resources  
</code></pre><p>Gradle 默认会从 src/main/java 搜寻打包源码，在 src/test/java 下搜寻测试源码。并且 src/main/resources 下的所有文件按都会被打包，所有 src/test/resources 下的文件 都会被添加到类路径用以执行测试。所有文件都输出到 build 下，打包的文件输出到 build/libs 下</p>
<p>比较有用的几个命令</p>
<p>编译、打包、测试</p>
<blockquote>
<p>build</p>
</blockquote>
<p>编译，以及运行单元测试</p>
<blockquote>
<p>test </p>
</blockquote>
<p>清理项目</p>
<blockquote>
<p>clean </p>
</blockquote>
<h2 id="简单配置-java-项目"><a href="#简单配置-java-项目" class="headerlink" title="简单配置 java 项目"></a>简单配置 java 项目</h2><p>配置依赖仓库，也就是依赖寻找的位置，可以使用本地仓库（自动缓存）、mavenCentral、Jcenter、阿里云或者自己搭建的镜像。</p>
<pre><code>    repositories {
        mavenLocal()
        maven { url &#39;http://maven.aliyun.com/nexus/content/groups/public/&#39; }
        maven { url &#39;http://maven.aliyun.com/nexus/content/repositories/jcenter&#39; }
        mavenCentral()
    }
</code></pre><p>配置依赖</p>
<pre><code>dependencies {
    testCompile group: &#39;junit&#39;, name: &#39;junit&#39;, version: &#39;4.+&#39;
}
</code></pre><p>gralde 总依赖除了有很多种类型，目前Gradle版本支持的依赖配置有：implementation、api、compileOnly、runtimeOnly 和 annotationProcessor，已经废弃的配置有：compile、provided、apk、providedCompile。</p>
<ul>
<li>implementation 会添加依赖到编译路径，并且会将依赖打包到输出（aar或apk），但是在编译时不会将依赖的实现暴露给其他module，也就是只有在运行时其他module才能访问这个依赖中的实现。</li>
<li>api 与compile对应，功能完全一样，会添加依赖到编译路径，并且会将依赖打包到输出（aar或apk），与implementation不同，这个依赖可以传递，其他module无论在编译时和运行时都可以访问这个依赖的实现，也就是会泄漏一些不应该不使用的实现。举个例子，A依赖B，B依赖C，如果都是使用api配置的话，A可以直接使用C中的类（编译时和运行时），而如果是使用implementation配置的话，在编译时，A是无法访问C中的类的。</li>
<li>compileOnly 与provided对应，Gradle把依赖加到编译路径，编译时使用，不会打包到输出（aar或apk）。这可以减少输出的体积，在只在编译时需要，在运行时可选的情况，很有用。</li>
<li>runtimeOnly 与apk对应，gradle添加依赖只打包到APK，运行时使用，但不会添加到编译路径。这个没有使用过。</li>
<li>annotationProcessor。编译前处理注解，例如 lombok。</li>
</ul>
<p>一个最简单的 java 项目可以由这两部分构成即可完成。</p>
<h2 id="spring-boot-插件"><a href="#spring-boot-插件" class="headerlink" title="spring boot 插件"></a>spring boot 插件</h2><p>在使用 Spring Boot 时，bootrun 这个task就是 Spring boot 插件提供的。</p>
<p>使用这个插件需要先配置 buildScript 告诉 gradle 插件从哪里找，因为 spring boot 并不是 gradle 的核心插件。</p>
<pre><code>buildscript {
    ext {
        springBootVersion = &#39;2.1.4.RELEASE&#39;
    }

    repositories {
        gradlePluginPortal()
    }

    dependencies {
    classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}&quot; as Object)
    }
}

</code></pre><p>然后添加</p>
<pre><code>apply plugin: &#39;org.springframework.boot&#39;
</code></pre><p>再查看 gradle tasks，就会多了一些 bootRun 等任务。</p>
<pre><code>
Application tasks
-----------------
bootRun - Runs this project as a Spring Boot application.

Build tasks
-----------
assemble - Assembles the outputs of this project.
bootBuildInfo - Generates a META-INF/build-info.properties file.
bootJar - Assembles an executable jar archive containing the main classes and their dependencies.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
classes - Assembles main classes.
clean - Deletes the build directory.
generateGitProperties
jar - Assembles a jar archive containing the main classes.
testClasses - Assembles test classes.


</code></pre><h2 id="dependency-management-插件"><a href="#dependency-management-插件" class="headerlink" title="dependency-management 插件"></a>dependency-management 插件</h2><p>上面讲插件的依赖引入后，Spring boot 还提供了另外一个非常高级的插件。</p>
<p>引入</p>
<pre><code>apply plugin: &#39;io.spring.dependency-management&#39;
</code></pre><p>Spring 版本火车中的子项目都可以不在需要指定版本号，版本号由 Spring boot 指定，从而解决 Spring 家族版本不一致的问题。</p>
<h2 id="wrapper"><a href="#wrapper" class="headerlink" title="wrapper"></a>wrapper</h2><p>wapper 是为了解决开发者拿到一个新项目没有本地安装的 gradle，或者版本不一致，导致非常不方便的问题。</p>
<p>配置项目时，需要用到 gradle 然后生成 gradle wrapper 文件（bat 或者 shell脚本）</p>
<ul>
<li>gradlew</li>
<li>gradlew.bat</li>
</ul>
<p>以及一些配置文件 .gradle</p>
<p>下一个开发者，运行项目时只需要有 java 不需要 gradle 即可使用 ./gradlew 运行即可。</p>
<p>首次生成 wrapper 的命令</p>
<blockquote>
<p>gradle wrapper </p>
</blockquote>
<h2 id="对-java-开发者需要注意的几个插件"><a href="#对-java-开发者需要注意的几个插件" class="headerlink" title="对 java 开发者需要注意的几个插件"></a>对 java 开发者需要注意的几个插件</h2><ul>
<li>java 插件</li>
<li>spring-boot 插件</li>
<li>dependency-management 插件</li>
</ul>
<h2 id="一份相对完整-spring-boot-配置清单"><a href="#一份相对完整-spring-boot-配置清单" class="headerlink" title="一份相对完整 spring boot 配置清单"></a>一份相对完整 spring boot 配置清单</h2><pre><code>// Gradle 构建本身需要的配置（例如插件仓库）
buildscript {
    // 配置变量
    ext {
        flywayVersion = &#39;3.2.1&#39;
        hibernateVersion = &#39;5.3.7.Final&#39;
    }
    // 插件仓库
    repositories {
        gradlePluginPortal()
    }
    // 应用插件需要的依赖包
    dependencies {
        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}&quot; as Object)
    }
}

// idea 插件，用来生成 idea 工程目录
apply plugin: &#39;idea&#39;
// java 插件,提供 build、jar 等task
apply plugin: &#39;java&#39;
// spring boot 插件提供 bootrun 等task，非必须
apply plugin: &#39;org.springframework.boot&#39;
// dependency-management 插件，为spring 版本火车项目提供一致的版本号
apply plugin: &#39;io.spring.dependency-management&#39;

// 指定构建输出目录
buildDir = &#39;./out&#39;

// 指定包信息
group = &#39;cn.printf&#39;
version = &#39;1.0.0&#39;

// java 版本
sourceCompatibility = 1.8
targetCompatibility = 1.8

// 编译字符集
tasks.withType(JavaCompile) { options.encoding = &#39;utf-8&#39; }

// 包依赖仓库
repositories {
    mavenLocal()
    maven { url &#39;http://maven.aliyun.com/nexus/content/groups/public/&#39; }
    maven { url &#39;http://maven.aliyun.com/nexus/content/repositories/jcenter&#39; }
    mavenCentral()
}

// 依赖
dependencies {
    // 监控
    compile &#39;org.springframework.boot:spring-boot-starter-actuator&#39;

    compileOnly &quot;org.projectlombok:lombok&quot;
    testCompileOnly &quot;org.projectlombok:lombok&quot;

    // web 
    compile &#39;org.springframework.boot:spring-boot-starter-web&#39;

    // Session
    compile &#39;org.springframework.boot:spring-boot-starter-data-redis&#39;
    compile &#39;org.springframework.session:spring-session-data-redis&#39;

    // database
    compile &#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;
    runtimeOnly &#39;mysql:mysql-connector-java&#39;

    // 数据库迁移
    compile &#39;org.flywaydb:flyway-core&#39;

    // 对象转换
    compile group: &#39;org.modelmapper&#39;, name: &#39;modelmapper&#39;, version: &#39;1.1.1&#39;

    // 加密库
    compile &#39;commons-codec:commons-codec:1.13&#39;

    // 测试
    testCompile(&quot;org.springframework.boot:spring-boot-starter-test&quot;)

    // 开发热启动工具
    runtime(&#39;org.springframework.boot:spring-boot-devtools&#39;)
}
</code></pre><h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><ul>
<li>教程 <a href="https://www.w3cschool.cn/gradle/6qo51htq.html" target="_blank" rel="noopener">https://www.w3cschool.cn/gradle/6qo51htq.html</a></li>
<li><a href="https://docs.gradle.org/current/userguide/command_line_interface.html" target="_blank" rel="noopener">https://docs.gradle.org/current/userguide/command_line_interface.html</a></li>
<li><a href="https://www.jianshu.com/p/59fd653a54d2" target="_blank" rel="noopener">https://www.jianshu.com/p/59fd653a54d2</a></li>
</ul>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
			
			
		
	
		
	
		
			
			
			
		
			
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
	
	
		<li class="prev"><a href="/运维开发/devops/CI-free-tools/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/运维开发/devops/aws-certificate-manager-faqs/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  
  &copy; 2020 少个分号
  
  <a href="/about" target="_blank">关于本站</a> |
  <a href="https://github.com/linksgo2011/wiki" target="_blank">github |</a>
  <a href="http://www.printf.cn" target="_blank">我的博客</a>
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


</body>
</html>
