<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>vc驿站视频教程笔记2 ansi 和 unicode | web 工程师知识系统</title>
  <meta name="author" content="少个分号">
  
  <meta name="description" content="-————————————————————————–VC 驿站WwW.CcTry.CoM多抽出一分钟时间来学习，让你的生命更加精彩！C、C++、VC++ 各种学习资源，免费教程，期待您的加入！动画教程只是起到技术交流的作用，请大家不用利用此方法做非法用途.由此动画造成的任何后果和动画作者及本站无关.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="vc驿站视频教程笔记2 ansi 和 unicode">
  <meta property="og:site_name" content="web 工程师知识系统">

  
    <meta property="og:image" content="undefined">
  

  
    <link rel="alternative" href="/atom.xml" title="web 工程师知识系统" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>
</html>
<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">web 工程师知识系统</a><span class="split"></span><span class="title">vc驿站视频教程笔记2 ansi 和 unicode</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2020-04-12</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  <div class="col-xs-12 col-sm-3 col-md-3 toc"> 
	<!-- toc -->
<script type="text/javascript">
		jQuery(document).ready(function() {
 		   generateWikiTOC('.note', '.toc',  2 , 2 );
		});
</script>
  </div><!-- col-md-3 -->
  
  

  
  <div class="col-xs-12 col-sm-9 col-md-9 note">
	

	  <!-- content -->
	  <p>-————————————————————————–<br>VC 驿站<br>WwW.CcTry.CoM<br>多抽出一分钟时间来学习，让你的生命更加精彩！<br>C、C++、VC++ 各种学习资源，免费教程，期待您的加入！<br>动画教程只是起到技术交流的作用，请大家不用利用此方法做非法用途.<br>由此动画造成的任何后果和动画作者及本站无关.<br>-—————————————————————————————<br>大家好，我是Syc<br>今天给大家做的教程是：<br>vc++基础班[2]—Ansi与Unicode<br>-—————————————————————————————<br>①、Ansi与Unicode简要说明及各自的优缺点：<br>他们是两种字符的编码格式，Ansi=窄字节，Unicode=宽字节，Ansi用char格式表示一个字符，占用一个字节的存储空间，最多表示255个字符，<br>表示英文还可以，但对于中文、日文、韩文等语言来说就不够用了，所以如果你的程序是Ansi编码的话，<br>那么你写的中文语言的程序拿到日文、韩文等系统上面就会出现乱码。所以有了Unicode，用二个字节去表示一个字符，格式是 unsigned short，被定义成 wchar_t 格式<br>这样就可以表示世界上绝大多数的语言了！但有利就有弊，缺点呢？就是空间占用翻倍了，网络传输的数据量也增大了……</p>
<p>◆ vc++ 6.0 默认为Ansi编码，vs2005、vs2008、vs2010 等默认都是Unicode编码，当然可以进行工程的设置从而进行编码的转换，见演示！</p>
<p>◆ 就我个人观点：还是建议大家使用Unicode宽字节的编码格式，具体见下面：</p>
<p>◆ 系统提供了两种类型的 API 函数，见：user32.dll 中的 MessageBox 函数，其实 MessageBox 他只是一个宏，他对应的两个版本的函数分别为：MessageBoxA 和 MessageBoxW，你在使用的时候系统会根据是否定义了_UNICODE 宏来进行判断该使用哪个版本的函数！如果你的工程没有定义_UNICODE 宏，那么就使用窄字节的 MessageBoxA，如果定义了，那么就使用宽字节的 MessageBoxW，具体在vs2008中，右键找定义，见演示！</p>
<p>◆ 网摘：Windows 2000 及其以后的 Xp、2003、Vista、Win7 等系统都是使用Unicode从头进行开发的，如果调用任何一个Windows API 函数并给它传递一个 ANSI 字符串，那么系统首先要将字符串转换成Unicode，然后将Unicode字符串传递给操作系统。如果希望函数返回ANSI字符串，系统就会先将Unicode字符串转换成ANSI字符串，然后将结果返回给你的应用程序。进行这些字符串的转换需要占用系统的时间和内存。通过从头开始用Unicode来开发应用程序，就能够使你的应用程序更加高效的运行！</p>
<p>==================================================================</p>
<p>②、不同编码格式下的字符串处理及相互转化：</p>
<p>◆ 大家在编程时经常遇到的数据类型：<br>● Ansi：<br>char、char <em> 、const char </em><br>CHAR、(PCHAR、PSTR、LPSTR)、LPCSTR</p>
<p>● Unicode：<br>wchar_t、wchar_t <em> 、const wchar_t </em><br>WCHAR、(PWCHAR、PWSTR、LPWSTR)、LPCWSTR</p>
<p>● T 通用类型：<br>TCHAR、(TCHAR * 、PTCHAR、PTSTR、LPTSTR)、LPCTSTR</p>
<p>以上，其中：P代表指针的意思，STR代表字符串的意思，L是长指针的意思，在WIN32平台下可以忽略，C代表const常量的意思，W代表wide宽字节的意思，T大家可以理解为通用类型的意思，<br>就是可以根据工程中是否定义_UNICODE 宏，分别定义成不同的类型，比如：TCHAR 类型，如果工程中定义了_UNICODE 宏，那么他最终被定义成 wchar_t 类型，<br>如果工程中没有定义_UNICODE 宏，那么 TCHAR 被最终定义成 char 类型。</p>
<p>〓※※※〓 其方便性就是修改了工程的编码格式之后不用修改代码，所以还是建议大家在编写程序的时候使用通用类型！</p>
<p>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</p>
<p>◆ 字符串类型的对象的定义：<br>● Ansi：char <em>pAnsiStr = “hello”;<br>● Unicode：wchar_t </em>pUnicodeStr = L”hello”;<br>● 通用类型：TCHAR <em>pTStr = _T(“hello”); 或者 TCHAR </em>pTStr = _TEXT(“hello”);<br>● 动态申请内存：TCHAR *pszBuf = new TCHAR[100];</p>
<p>其中，_TEXT 和 _T 是一样的，定义如下：<br>#define _T(x) <strong>T(x)<br>#define _TEXT(x) </strong>T(x)</p>
<p>来看看 <strong>T 的最终定义：<br>#ifdef _UNICODE<br>#define </strong>T(x) L##x<br>#else<br>#define __T(x) x<br>#endif</p>
<p>其中，##为连接起来的意思。</p>
<p>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</p>
<p>◆ 常用的字符串处理函数，具体信息见MSDN：<br>字符串长度：<br>● Ansi：strlen(char <em>str);<br>● Unicode：wcslen(wchar_t </em>str);<br>● 通用函数：_tcslen(TCHAR *str);</p>
<p>● Ansi：int atoi(const char <em>str);<br>● Unicode：int _wtoi(const wchar_t </em>str);<br>● 通用函数：_tstoi(const TCHAR *str);</p>
<p>字符串拷贝：<br>● Ansi：strcpy(char <em>strDestination, const char </em>strSource);<br>● Unicode：wcscpy(wchar_t <em>strDestination, const wchar_t </em>strSource);<br>● 通用函数：_tcscpy(TCHAR <em>strDestination, const TCHAR </em>strSource);</p>
<p>以上函数不安全，在vs2003等以上版本的编译器中会有warnning警告提示，以下为安全函数（vc++6.0不支持）：<br>● Ansi：strcpy_s(char <em>strDestination, size_t numberOfElements, const char </em>strSource);<br>● Unicode：wcscpy_s(wchar_t <em>strDestination, size_t numberOfElements, const wchar_t </em>strSource);<br>● 通用函数：_tcscpy_s(TCHAR <em>strDestination, size_t numberOfElements, const TCHAR </em>strSource);</p>
<p>numberOfElements<br>Size of the destination string buffer. 目的缓冲区的大小，以字节为单位，不是字符！</p>
<p>size_t unsigned integer，在MSDN中的解释：Result of sizeof operator，也就是说 size_t 是 unsigned integer 即无符号整数。那为什么会有size_t这个类型呢？<br>因为不同平台的操作系统(32/64)中 int/long 等类型所占的字节并不一样，而 size_t 在不同的平台下有不同的定义。有点类似于TCHAR类型：<br>#ifndef _SIZE_T_DEFINED<br>#ifdef _WIN64<br>typedef unsigned __int64 size_t; //8个字节，64位<br>#else<br>typedef _W64 unsigned int size_t; //4个字节，32位<br>#endif<br>#define _SIZE_T_DEFINED<br>#endif</p>
<p>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</p>
<p>◆ Ansi 与 Unicode 字符串类型的互相转换：<br>上面给大家介绍的都是窄字节就是窄字节，宽字节就是宽字节，那么下面就给大家介绍下他们两个之间的转换。<br>在程序中还是不建议大家来回来去的进行字符串编码之间的转换，要么就都使用Ansi，要么就都使用Unicode，<br>但是往往有些函数只提供了窄字节版本（比如：GetProcAddress）或者只提供宽字节版本（比如：CommandLineToArgvW），<br>这个时候就要进行字符串编码格式的转换了。</p>
<p>但是，不是所有的都需要转换，有一些是不需要转换的，比如 socket 中的 send 或者 recv 函数！</p>
<p>● 转换用到的最根本的 API 函数：<br>WideCharToMultiByte 实现宽字节转换到窄字节<br>MultiByteToWideChar 实现窄字节转换到宽字节</p>
<p>WideCharToMultiByte 的代码页用来标记与新转换的字符串相关的代码页；<br>MultiByteToWideChar 的代码页用来标记与一个多字节字符串相关的代码页，</p>
<p>[1]、常用的代码页有 CP_ACP 和 CP_UTF8 两个：<br>使用 CP_ACP 代码页就实现了 ANSI 与 Unicode 之间的转换；— 我们所用的！<br>使用 CP_UTF8 代码页就实现了 UTF-8 与 Unicode 之间的转换。</p>
<p>[2]、dwFlags 参数允许我们进行额外的控制，但是，一般情况下都不使用这个标志，直接传递 0 就行了。</p>
<p>[3]、lpDefaultChar和pfUsedDefaultChar：只有当WideCharToMultiByte函数遇到一个宽字节字符，而该字符在uCodePage参数标识的代码页中并没有它的表示法时，WideCharToMultiByte函数才使用这两个参数。如果宽字节字符不能被转换，该函数便使用lpDefaultChar参数指向的字符。如果该参数是NULL（这是大多数情况下的参数值），那么该函数使用系统的默认字符。该默认字符通常是个问号。这对于文件名来说是危险的，因为问号是个通配符。pfUsedDefaultChar参数指向一个布尔变量，如果Unicode字符串中至少有一个字符不能转换成等价多字节字符，那么函数就将该变量置为TRUE。如果所有字符均被成功地转换，那么该函数就将该变量置为FALSE。当函数返回以便检查宽字节字符串是否被成功地转换后，可以测试该变量。</p>
<p>● 两个转换函数的使用：<br>● A2W、W2A、T2A、T2W 宏的使用：</p>
<p>③、CString常用操作讲解</p>
<p>————————————- End ——————————————-</p>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
			
		
	
		
			
			
			
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
	
	
		<li class="prev"><a href="/c-c/c&c++/cctry-note-4/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/c-c/c&c++/cctry-note1/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  
  &copy; 2020 少个分号
  
  <a href="/about" target="_blank">关于本站</a> |
  <a href="https://github.com/linksgo2011/wiki" target="_blank">github |</a>
  <a href="http://www.printf.cn" target="_blank">我的博客</a>
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


</body>
</html>
