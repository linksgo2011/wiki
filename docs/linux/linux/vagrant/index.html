<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Linux 虚拟机管理 Vagrant | 架构师知识系统</title>
  <meta name="author" content="少个分号">
  
  <meta name="description" content="虚拟机管理工具在 window 上下载安装包安装即可，在 Mac 上使用 brew 安装
安装 VisualBox

brew install caskroom/cask/virtualbox

安装 Vagrant

brew install caskroom/cask/vagrant

可以去 ">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Linux 虚拟机管理 Vagrant">
  <meta property="og:site_name" content="架构师知识系统">

  
    <meta property="og:image" content="undefined">
  

  
    <link rel="alternative" href="/atom.xml" title="架构师知识系统" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>
</html>
<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">架构师知识系统</a><span class="split"></span><span class="title">Linux 虚拟机管理 Vagrant</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2019-11-05</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  <div class="col-xs-12 col-sm-3 col-md-3 toc"> 
	<!-- toc -->
<script type="text/javascript">
		jQuery(document).ready(function() {
 		   generateWikiTOC('.note', '.toc',  2 , 2 );
		});
</script>
  </div><!-- col-md-3 -->
  
  

  
  <div class="col-xs-12 col-sm-9 col-md-9 note">
	

	  <!-- content -->
	  <h2 id="虚拟机管理工具"><a href="#虚拟机管理工具" class="headerlink" title="虚拟机管理工具"></a>虚拟机管理工具</h2><p>在 window 上下载安装包安装即可，在 Mac 上使用 brew 安装</p>
<p>安装 VisualBox</p>
<blockquote>
<p>brew install caskroom/cask/virtualbox</p>
</blockquote>
<p>安装 Vagrant</p>
<blockquote>
<p>brew install caskroom/cask/vagrant</p>
</blockquote>
<p>可以去 <a href="http://www.vagrantbox.es/" target="_blank" rel="noopener">http://www.vagrantbox.es/</a>  下载 Vagrant 封装好的镜像，然后直接导入，否则自己下载镜像配置。</p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>添加虚拟机</p>
<p>可以在 <a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener">https://app.vagrantup.com/boxes/search</a> 上寻找和下载 virtualbox 文件</p>
<blockquote>
<p>vagrant box add centos7 /Users/nlin/www/env/centos-7.0-x86_64.box</p>
</blockquote>
<p>初始化虚拟机，如果未添加虚拟机文件会自动从仓库里下载，第一次初始化会生成一个 Vagrantfile 文件用于管理素所有命令操作后的变化，利于版本管理:</p>
<blockquote>
<p>vagrant init centos7  </p>
</blockquote>
<p>vagrant box add 添加时可以给一个不同的名称，用于启动多个虚拟机,这里设置一个 manager 用于 swarm manager:</p>
<blockquote>
<p>vagrant box add manager /Users/nlin/www/env/centos-7.0-x86_64.box<br>vagrant init manager</p>
</blockquote>
<p>启动虚拟机</p>
<blockquote>
<p>vagrant up</p>
</blockquote>
<p>查看当前运行的虚拟机</p>
<blockquote>
<p>vagrant box list</p>
</blockquote>
<p>进入虚拟机</p>
<blockquote>
<p>vagrant ssh</p>
</blockquote>
<p>更多有用命令</p>
<blockquote>
<p>vagrant -h</p>
</blockquote>
<p>一份整理好的 vagrant 文件</p>
<pre><code># -*- mode: ruby -*-
# vi: set ft=ruby :

$setup_jenkins_server = &lt;&lt;SCRIPT
sudo yum -y install ansible
sudo yum -y install git
sudo chown -R ansible /vagrant
SCRIPT

$setup_ansible_user = &lt;&lt;SCRIPT
sudo useradd ansible --groups vagrant
sudo mkdir -p /home/ansible/.ssh/ &amp;&amp; sudo cp -rf /home/vagrant/.ssh/authorized_keys /home/ansible/.ssh/authorized_keys
sudo chown -R ansible /home/ansible/.ssh
sudo chmod 600 /home/ansible/.ssh/authorized_keys
SCRIPT

Vagrant.configure(2) do |config|
  config.vm.box = &quot;centos/7&quot;
  config.vm.provider &quot;virtualbox&quot; do |v|
    v.memory = 1024
  end
  config.vm.box_check_update = false

  VAGRANT_COMMAND = ARGV[0]
  if VAGRANT_COMMAND == &quot;ssh&quot;
    config.ssh.username = &#39;ansible&#39;
  end

  config.vm.define &quot;jenkins-server&quot; do |dev|
    config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;
    dev.vm.network &quot;private_network&quot;, ip: &quot;10.132.112.10&quot;
    dev.vm.hostname = &quot;jenkins-server&quot;
    dev.vm.provision :shell, inline: $setup_ansible_user
    dev.vm.provision :shell, inline: $setup_jenkins_server
  end

  config.vm.define &quot;jenkins-agent-1&quot; do |dev|
    dev.vm.network &quot;private_network&quot;, ip: &quot;10.132.112.11&quot;
    dev.vm.hostname = &quot;jenkins-agent&quot;
    dev.vm.provision :shell, inline: $setup_ansible_user
  end

  config.vm.define &quot;manager1&quot; do |dev|
    config.vm.provider &quot;virtualbox&quot; do |v|
      v.memory = 2048
    end
    dev.vm.network &quot;private_network&quot;, ip: &quot;10.132.112.21&quot;
    dev.vm.hostname = &quot;manager1&quot;
    dev.vm.provision :shell, inline: $setup_ansible_user
    # dev.vm.network :forwarded_port, guest: 80, host: 9080
  end

   config.vm.define &quot;manager2&quot; do |dev|
     config.vm.provider &quot;virtualbox&quot; do |v|
       v.memory = 2048
     end
     dev.vm.network &quot;private_network&quot;, ip: &quot;10.132.112.22&quot;
     dev.vm.hostname = &quot;manager2&quot;
     dev.vm.provision :shell, inline: $setup_ansible_user
   end

  config.vm.define &quot;worker1&quot; do |dev|
    dev.vm.network &quot;private_network&quot;, ip: &quot;10.132.112.23&quot;
    dev.vm.hostname = &quot;worker1&quot;
    dev.vm.provision :shell, inline: $setup_ansible_user
  end

  config.vm.define &quot;worker2&quot; do |dev|
    dev.vm.network &quot;private_network&quot;, ip: &quot;10.132.112.24&quot;
    dev.vm.hostname = &quot;worker2&quot;
    dev.vm.provision :shell, inline: $setup_ansible_user
  end
end

</code></pre><p>只需要创建文件 Vagrantfile 并粘贴上面内容，然后运行：</p>
<blockquote>
<p>vagrant up</p>
</blockquote>
<p>可以快速的创建一组虚拟机。启动成功后，运行 provision 命令初始化 ansible 以及 docker 等基本工具。</p>
<p>服务器上的 Jenkins 机器需要自己手动安装 ansible 以及 git， 最好配置一个 ansible user，否则修改 hosts 中 ansible_user 使用 root 用户连接。</p>
<blockquote>
<p>yum -y install ansible<br>yum -y install git</p>
</blockquote>
<p>其他机器全部使用 ansible 来操作。</p>
<h2 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h2><ul>
<li>官方文档 <a href="https://www.vagrantup.com/docs/index.html" target="_blank" rel="noopener">https://www.vagrantup.com/docs/index.html</a></li>
<li>安装方法 <a href="https://blog.csdn.net/yanyan42/article/details/79697659" target="_blank" rel="noopener">https://blog.csdn.net/yanyan42/article/details/79697659</a></li>
<li>一个快速上手教程 <a href="https://www.jianshu.com/p/7e8f61376053" target="_blank" rel="noopener">https://www.jianshu.com/p/7e8f61376053</a></li>
</ul>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
			
			
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
	
	
		<li class="prev"><a href="/linux/linux/linux-gen-ssh-key/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/linux/linux/linux-nohup/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  
  &copy; 2020 少个分号
  
  <a href="/about" target="_blank">关于本站</a> |
  <a href="https://github.com/linksgo2011/wiki" target="_blank">github |</a>
  <a href="http://www.printf.cn" target="_blank">我的博客</a>
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


</body>
</html>
