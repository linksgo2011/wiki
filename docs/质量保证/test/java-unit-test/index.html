<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>一本小小的单元测试书 | web 工程师知识系统</title>
  <meta name="author" content="少个分号">
  
  <meta name="description" content="[TOC]
单元测试基础什么是单元测试?
在计算机编程中，单元测试（英语：Unit Testing）又称为模块测试，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。 ——维基百科 

什么是一个单元？
在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="一本小小的单元测试书">
  <meta property="og:site_name" content="web 工程师知识系统">

  
    <meta property="og:image" content="undefined">
  

  
    <link rel="alternative" href="/atom.xml" title="web 工程师知识系统" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>
</html>
<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">web 工程师知识系统</a><span class="split"></span><span class="title">一本小小的单元测试书</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2020-05-31</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <p>[TOC]</p>
<h2 id="单元测试基础"><a href="#单元测试基础" class="headerlink" title="单元测试基础"></a>单元测试基础</h2><h3 id="什么是单元测试"><a href="#什么是单元测试" class="headerlink" title="什么是单元测试?"></a>什么是单元测试?</h3><blockquote>
<p>在计算机编程中，单元测试（英语：Unit Testing）又称为模块测试，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。 ——维基百科 </p>
</blockquote>
<p>什么是一个单元？</p>
<p>在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。</p>
<p>因此“单元”是一个相对概念，因此对方法、类、模块、应用都可以被当作单元测试。简单来说，单元测试的初衷是对应用的一小部分及时的测试，而非等到所有的代码编写完成启动整个应用测试。</p>
<p>通常来说来说单元测试是在类、方法这个层面而言。与之相对的是集成测试、E2E 测试。</p>
<h3 id="为什么需要写单元测试？"><a href="#为什么需要写单元测试？" class="headerlink" title="为什么需要写单元测试？"></a>为什么需要写单元测试？</h3><p>在没有接触单元测试之前我们是怎么做测试的？一般有两个方法：</p>
<ol>
<li>启动整个应用，像用户正常操作一样。点击界面按钮，调用一个 API 等。手动测试的坏处是每次测试都得启动整个应用，项目稍微一大非常慢，PHP、Nodejs 还好，尤其是 Java、C++ 这种编译型语言非常痛苦。</li>
</ol>
<ol start="2">
<li>在代码某个地方写一个临时入口，例如 java 的 main 方法，测试某个方法或者某个类，用完留在项目中或者删除。如果不删除的话会让项目变得很乱，删除的话下次想测试又得弄个新得。</li>
</ol>
<p>这两个方法都有一个共同得不足，没法保留测试数据的创建过程，场景、边界的覆盖基本随缘。<br>单元测试本质上就是方法 2，把类似 main 方法的测试代码统一放到一个地方。然后根据一些约定，让代码更加简洁。但不强制你把测试代码放到任何一个地方。</p>
<p>根据约定：</p>
<ul>
<li>test 代码单独放到 src/test 目录下，与 src/main 一一对应</li>
<li>测试类和源代码保持同名+Test 后缀</li>
</ul>
<p>理论上不使用任何测试框架也可以完成编写单元测试，最初的单元测试也是这样。不过好在现在可以利用 xUnit 等框架更方便的运行测试。使用框架的单元测试好处有：</p>
<ul>
<li>通过 Runer 可以批量运行</li>
<li>使用 @Before 等钩子实现数据准备、数据清理</li>
<li>通过断言实现结果的验证，避免人工确定结果的正确性</li>
<li>通过覆盖率统计工具，统计代码测试覆盖率</li>
<li>通过 Mock 解决代码相互依赖的问题</li>
</ul>
<p>当然，编写单元测试的目的除了测试方便之外，还有一个重要的用途：重构。</p>
<p>某些场景下，你需要改造一些遗留代码，并接近 100% 兼容原来的逻辑，没有单元测试保护的情况下，没人敢改，造成代码越来越混乱。通过单元测试对原来的业务逻辑进行覆盖，在有保护的情况开始重构，重构完成后再次运行单元测试，如果能通过测试说明基本上没有破坏性改动。</p>
<p>这是单元测试非常重要的一个用途。</p>
<p>Junit 是 Java 的单元测试套件，我们可以从最简单的单元测试开始对 Java 的一个方法进行验证，而不必启动整个应用。 </p>
<h3 id="第一个-Junit-测试"><a href="#第一个-Junit-测试" class="headerlink" title="第一个 Junit 测试"></a>第一个 Junit 测试</h3><h3 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h3><h3 id="测试异常"><a href="#测试异常" class="headerlink" title="测试异常"></a>测试异常</h3><h3 id="准备数据和清理数据"><a href="#准备数据和清理数据" class="headerlink" title="准备数据和清理数据"></a>准备数据和清理数据</h3><h3 id="设计一个好的用例"><a href="#设计一个好的用例" class="headerlink" title="设计一个好的用例"></a>设计一个好的用例</h3><h3 id="使用-Idea-查看测试覆盖情况"><a href="#使用-Idea-查看测试覆盖情况" class="headerlink" title="使用 Idea 查看测试覆盖情况"></a>使用 Idea 查看测试覆盖情况</h3><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h2 id="为-Spring-应用编写测试"><a href="#为-Spring-应用编写测试" class="headerlink" title="为 Spring 应用编写测试"></a>为 Spring 应用编写测试</h2><h3 id="认识-Runner"><a href="#认识-Runner" class="headerlink" title="认识 Runner"></a>认识 Runner</h3><h3 id="SpringJUnit4ClassRunner"><a href="#SpringJUnit4ClassRunner" class="headerlink" title="SpringJUnit4ClassRunner"></a>SpringJUnit4ClassRunner</h3><h3 id="Mock"><a href="#Mock" class="headerlink" title="Mock"></a>Mock</h3><h3 id="verify"><a href="#verify" class="headerlink" title="verify"></a>verify</h3><h3 id="加载-classpath-文件"><a href="#加载-classpath-文件" class="headerlink" title="加载 classpath 文件"></a>加载 classpath 文件</h3><h2 id="Spring-boot-测试实践"><a href="#Spring-boot-测试实践" class="headerlink" title="Spring boot 测试实践"></a>Spring boot 测试实践</h2><h3 id="SpringBootTest-注解"><a href="#SpringBootTest-注解" class="headerlink" title="@SpringBootTest 注解"></a>@SpringBootTest 注解</h3><h3 id="加载测试配置"><a href="#加载测试配置" class="headerlink" title="加载测试配置"></a>加载测试配置</h3><h3 id="内嵌数据库"><a href="#内嵌数据库" class="headerlink" title="内嵌数据库"></a>内嵌数据库</h3><h3 id="内嵌-Redis"><a href="#内嵌-Redis" class="headerlink" title="内嵌 Redis"></a>内嵌 Redis</h3><h3 id="测试分层概念"><a href="#测试分层概念" class="headerlink" title="测试分层概念"></a>测试分层概念</h3><h3 id="测试领域层"><a href="#测试领域层" class="headerlink" title="测试领域层"></a>测试领域层</h3><h3 id="测试控制器"><a href="#测试控制器" class="headerlink" title="测试控制器"></a>测试控制器</h3><h2 id="测试静态、私有方法"><a href="#测试静态、私有方法" class="headerlink" title="测试静态、私有方法"></a>测试静态、私有方法</h2><h3 id="powermock-入门"><a href="#powermock-入门" class="headerlink" title="powermock 入门"></a>powermock 入门</h3><h2 id="TDD和重构"><a href="#TDD和重构" class="headerlink" title="TDD和重构"></a>TDD和重构</h2><h2 id="单元测试高级"><a href="#单元测试高级" class="headerlink" title="单元测试高级"></a>单元测试高级</h2><h3 id="工程化"><a href="#工程化" class="headerlink" title="工程化"></a>工程化</h3><h3 id="jcoco"><a href="#jcoco" class="headerlink" title="jcoco"></a>jcoco</h3><h3 id="测试性能"><a href="#测试性能" class="headerlink" title="测试性能"></a>测试性能</h3><h3 id="多线程和并发"><a href="#多线程和并发" class="headerlink" title="多线程和并发"></a>多线程和并发</h3><h3 id="junit5-的使用"><a href="#junit5-的使用" class="headerlink" title="junit5 的使用"></a>junit5 的使用</h3>	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
	
		
	
		
			
			
		
	
		
	
		
			
			
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
	
	
		<li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/质量保证/test/java-test-in-all/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  
  &copy; 2020 少个分号
  
  <a href="/about" target="_blank">关于本站</a> |
  <a href="https://github.com/linksgo2011/wiki" target="_blank">github |</a>
  <a href="http://www.printf.cn" target="_blank">我的博客</a>
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


</body>
</html>
